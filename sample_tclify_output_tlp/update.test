set testdir [file dirname $argv0]
source $testdir/tester.tcl

# kill mutants ['181', '184']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test update-dredd-1.1 {
  CREATE TABLE a(b);
  INSERT INTO a VALUES('12079096');
  CREATE UNIQUE INDEX c ON a(x'') WHERE b;
  UPDATE a SET(b) = 0;
  ALTER TABLE a ADD d;
  ALTER TABLE a RENAME TO e;
  INSERT INTO e VALUES(1, 0);
} {}

# kill mutants ['3978', '3980', '3982', '3983', '3986', '3987']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test update-dredd-2.1 {
   PRAGMA encoding = 'UTF16le';
                           CREATE TABLE a (c0 REAL );
                           ANALYZE;
                           ALTER TABLE a ADD b BLOB CHECK ( CAST(CASE WHEN a.c0 THEN a.c0 ELSE a.c0 END AS NUMERIC));
                           ALTER TABLE a RENAME b TO c10;
                           CREATE INDEX i82 ON a(c10,CAST((((c10, c10, c0))==((c0, c0, c0))) AS REAL)) WHERE ((CAST(c0 AS NUMERIC))AND((NULL IN (c0))));
                           CREATE UNIQUE INDEX i42 ON a(CAST(((('deb8'))=((c10))) AS TEXT),0 COLLATE RTRIM ASC) WHERE 'qA';
                           ALTER TABLE a RENAME TO t1;
} {}

# kill mutants ['149', '152']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_catchsql_test update-dredd-3.1 {
  CREATE TABLE a(b);
  INSERT INTO a VALUES('eb83');
  CREATE UNIQUE INDEX c ON a(0) WHERE b;
  INSERT INTO a VALUES('');
  UPDATE a SET b == 1;
} {1 {UNIQUE constraint failed: index 'c'}}

# kill mutants ['173']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test update-dredd-4.1 {
  CREATE TABLE t0(c1);
   CREATE INDEX i96 ON t0((~0), (NULL)COLLATE BINARY,                        0.5217806521967385 COLLATE RTRIM);
   UPDATE t0 SET c1 = 'd౛g_t+䬠Q';
} {}

# kill mutants ['3977', '3979', '3985', '3988']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test update-dredd-5.1 {
  CREATE TABLE t1(c0);
  INSERT INTO t1 VALUES(x'');
  PRAGMA journal_mode = WAL;
} {wal}
do_execsql_test update-dredd-5.2 {
  UPDATE t1 SET(c0, c0, c0) = (0, 0, x'');
  PRAGMA wal_checkpoint;
} {0 0 0}

# kill mutants ['178']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test update-dredd-6.1 {
  CREATE TABLE a(b, c, d);
  ALTER TABLE a RENAME TO e;
  CREATE INDEX f ON e(b, CASE WHEN 1 THEN c END);
  INSERT INTO e VALUES(0, '<', 0);
  UPDATE e SET(c) = 0;
  UPDATE e SET(b) = 0;
} {}

# kill mutants ['179']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_catchsql_test update-dredd-7.1 {
  CREATE TABLE t1(c0, c1, c2);
  INSERT INTO t1 VALUES('', x'', 0);
  ALTER TABLE t1 ADD c75;
  INSERT OR ROLLBACK INTO t1(c2, c75, c0) VALUES(0, '', 0);
  CREATE UNIQUE INDEX i76 ON t1(0, 0, CAST(c1 AS) COLLATE NOCASE);
  UPDATE OR ABORT t1 SET(c1, c75) = (x'', 0);
} {1 {UNIQUE constraint failed: index 'i76'}}

# kill mutants ['3760']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test update-dredd-8.1 {
  CREATE TABLE a(b, c PRIMARY KEY) WITHOUT ROWID;
  INSERT INTO a VALUES('6hr(/%V', 0);
  UPDATE a SET c = 0 <= 0;
} {}

# kill mutants ['177']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test update-dredd-9.1 {
  CREATE TABLE t0(c2);
  ALTER TABLE t0 RENAME TO t1;
  CREATE INDEX i13 ON t1(0, 0 COLLATE RTRIM);
  UPDATE OR FAIL t1 SET c2 = 'h6,';
} {}

finish_test
