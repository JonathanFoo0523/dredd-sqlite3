set testdir [file dirname $argv0]
source $testdir/tester.tcl

# kill mutants ['259', '260', '261', '262', '263']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_catchsql_test window-dredd-1.1 {
  SELECT NTH_VALUE('', 0) OVER(RANGE CURRENT ROW EXCLUDE NO OTHERS);
} {1 {second argument to nth_value must be a positive integer}}

# kill mutants ['10942']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_catchsql_test window-dredd-2.1 {
  CREATE TABLE f (a ) ;
                   CREATE TEMP TABLE    b (a  , c  , c2 );
                   ALTER TABLE b ADD c43 c44;
                   ALTER TABLE b RENAME a TO d  ;
                   ALTER TABLE b RENAME TO e;
                   SELECT  COUNT((c)GLOB(d)) OVER ( PARTITION BY CASE e.c2  WHEN e.c43 THEN e.c2 END BETWEEN e.c=e.c43 AND 0>d, 0 ROWS BETWEEN 0 FOLLOWING AND END FOLLOWING), AVG(0)FROM e RIGHT  JOIN f ON 0 BETWEEN (e.c43>d) AND 0;
} {1 {frame ending offset must be a non-negative integer}}

# kill mutants ['2379', '2381', '2388', '2411', '2413']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test window-dredd-3.1 {
  SELECT TOTAL(0 IS FALSE) OVER();
} {1.0}

# kill mutants ['3609', '3641']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test window-dredd-4.1 {
  CREATE TABLE a(b);
  ALTER TABLE a ADD c;
  REPLACE INTO a VALUES('1f84', ''), (NULL, 0.31702424464621537), ('', NULL);
  SELECT DISTINCT DENSE_RANK() OVER(), LAST_VALUE(0) OVER(PARTITION BY 0) FROM a;
} {1 0}

# kill mutants ['7561', '7593']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test window-dredd-5.1 {
  SELECT PERCENT_RANK() OVER(), LAG(0, CAST(CASE WHEN 0 THEN 6 END AS), 0) OVER();
} {0.0 0}

# kill mutants ['11983', '12015']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_catchsql_test window-dredd-6.1 {
  SELECT LAST_VALUE(NULL)
      OVER(ORDER BY(0, CASE WHEN 8 THEN 6 END, 0) >
           (0, 0, CASE WHEN 3 THEN 'k|l)d' END)GROUPS(a) PRECEDING);
} {1 {frame starting offset must be a non-negative integer}}

# kill mutants ['10910']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test window-dredd-7.1 {
  CREATE TABLE c(a);
  CREATE TABLE b(d, e);
  ALTER TABLE b ADD f;
  ALTER TABLE b RENAME d TO g;
  ALTER TABLE b RENAME TO h;
  SELECT COUNT() OVER(PARTITION BY CASE WHEN f THEN 2 END BETWEEN e AND f > 0),
      AVG(0) FROM h RIGHT JOIN c ON 0 BETWEEN f > g AND 0;
} {1 {}}

# kill mutants ['1322']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_catchsql_test window-dredd-8.1 {
  SELECT ROW_NUMBER() OVER(RANGE BETWEEN a PRECEDING AND b FOLLOWING);
} {1 {RANGE with offset PRECEDING/FOLLOWING requires one ORDER BY expression}}

# kill mutants ['4146']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_catchsql_test window-dredd-9.1 {
  PRAGMA temp_store=MEMORY ;
  CREATE TABLE t0 (c0  , c1  , c2  );
  ALTER TABLE t0 ADD c5 ;
  INSERT INTO a VALUES ('');  0ms;
} {1 {no such table: a}}
do_execsql_test window-dredd-9.2 {
  ALTER TABLE t0 ADD COLUMN c9 INTEGER; -- 0ms
  INSERT OR REPLACE INTO t0(c5, c2, c1, c0, c9) VALUES ('', NULL, '', NULL, NULL); -- 0ms
  ALTER TABLE t0 RENAME TO t1; -- 0ms
  ALTER TABLE t1 RENAME TO t0; -- 0ms
  SELECT ALL PERCENT_RANK() OVER (), ( t0.c9) IS FALSE, LEAD(json_remove(CASE WHEN t0.c1 THEN t0.c2 WHEN t0.c9 THEN t0.c5 WHEN t0.c2 THEN t0.c9 END,  NOT NULL, 0, COALESCE(t0.c0, t0.c0)), 0.3917770324424138, 0%0 NOTNULL) OVER ( PARTITION BY RTRIM(t0.c0)OR(0), x'') FROM t0 WHERE '1476944519'  ;
} {0.0 0 0}

# kill mutants ['1325']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_catchsql_test window-dredd-10.1 {
  SELECT LAG(a) OVER(RANGE b PRECEDING);
} {1 {RANGE with offset PRECEDING/FOLLOWING requires one ORDER BY expression}}

finish_test
