set testdir [file dirname $argv0]
source $testdir/tester.tcl

# kill mutants ['0', '1', '10', '104', '107', '110', '117', '119', '12', '123', '127', '128', '13', '14', '140', '148', '151', '152', '154', '160', '17', '172', '18', '180', '183', '184', '186', '2', '20', '21', '22', '24', '27', '28', '38', '39', '40', '41', '42', '44', '45', '46', '49', '50', '52', '53', '54', '56', '59', '6', '60', '63', '64', '67', '7', '72', '75', '751', '752', '753', '754', '756', '759', '760', '761', '762', '764', '767', '768', '769', '771', '772', '78', '788', '790', '791', '794', '795', '798', '799', '8', '800', '801', '803', '804', '820', '822', '823', '826', '827', '830', '831', '85', '87', '9', '91', '922', '923', '924', '925', '926', '927', '934', '935', '939', '940', '942', '944', '945', '947', '948', '95', '954', '955', '956', '957', '958', '959', '96', '98', '99', '998']
reset_db
sqlite3_db_config db DEFENSIVE 1
sqlite3_enable_load_extension db 1
do_catchsql_test loadext-dredd-1.1 {
  SELECT load_extension(0);
} {1 {0.so: cannot open shared object file: No such file or directory}}

# kill mutants ['23', '25', '26', '3', '35', '37', '5', '55', '57', '58', '62', '757', '775', '776', '777', '779', '807', '808', '809', '811']
reset_db
sqlite3_db_config db DEFENSIVE 1
sqlite3_enable_load_extension db 1
do_catchsql_test loadext-dredd-2.1 {
  CREATE TABLE a(b);
  INSERT INTO a VALUES('xC\}');
  CREATE VIRTUAL TABLE rt42 USING rtree_i32(c, d, e, +f);
  UPDATE a SET b ='';
  INSERT OR IGNORE INTO rt42 VALUES(x'', '', '', x'');
  SELECT(SELECT 0 FROM a JOIN rt42 ON CASE load_extension(b) WHEN 0 THEN 0 END);
} {1 {unable to open shared library []}}

# kill mutants ['933', '936', '937', '938', '941', '946']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_catchsql_test loadext-dredd-3.1 {
  CREATE VIRTUAL TABLE a USING b;
} {1 {no such module: b}}

# kill mutants ['66']
reset_db
sqlite3_db_config db DEFENSIVE 1
sqlite3_enable_load_extension db 1
do_catchsql_test loadext-dredd-4.1 {
  CREATE VIRTUAL TABLE a USING rtree(b, c, d);
  INSERT INTO a(d) VALUES('38c5');
  SELECT(SELECT load_extension(c) FROM a);
} {1 {0.0.so: cannot open shared object file: No such file or directory}}

# kill mutants ['785']
reset_db
sqlite3_db_config db DEFENSIVE 1
sqlite3_enable_load_extension db 1
do_catchsql_test loadext-dredd-5.1 {
  VALUES(load_extension(0));
} {1 {0.so: cannot open shared object file: No such file or directory}}

# kill mutants ['952']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_catchsql_test loadext-dredd-6.1 {
  CREATE TABLE a(b);
  CREATE TRIGGER c DELETE ON a BEGIN SELECT d;
  END;
  ALTER TABLE a RENAME TO e;
} {1 {error in trigger c: no such column: d}}

# kill mutants ['953']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test loadext-dredd-7.1 {
  CREATE VIRTUAL TABLE a USING fts5(0);
  INSERT INTO a VALUES('integritycheck');
} {}

finish_test
