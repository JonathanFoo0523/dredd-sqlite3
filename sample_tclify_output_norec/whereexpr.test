set testdir [file dirname $argv0]
source $testdir/tester.tcl

# kill mutants ['7050', '7052', '7053', '7054', '7055', '7056', '7057', '7082', '7084', '7085', '7086', '7087', '7088', '7089', '7093', '7094', '7095', '7096', '7097', '7098', '7099', '7100', '7101', '7102', '7103', '7106', '7107', '7116', '7124', '7133', '7138', '7139', '7148', '7156', '7165', '7179', '7182', '7198', '7211', '7214', '7230', '7233', '7237', '7238', '7240', '7241', '7242', '7248', '7265', '7269', '7270', '7272', '7273', '7274', '7280', '7305', '7306', '7337', '7338']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test whereexpr-dredd-1.1 {
  CREATE TABLE a(b PRIMARY KEY);
  INSERT INTO a VALUES('');
  INSERT INTO a VALUES(0);
  SELECT *FROM a WHERE(b) NOTNULL;
} {0 {}}

# kill mutants ['8914']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test whereexpr-dredd-2.1 {
  CREATE VIRTUAL TABLE a USING rtree(b, c, d);
  INSERT INTO a(d) VALUES( '');
  CREATE VIRTUAL TABLE e USING fts5(0);
  SELECT(SELECT 0 FROM a LEFT JOIN e ON b IN(0));
} {0}

# kill mutants ['6806', '6807', '6811', '6813']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_catchsql_test whereexpr-dredd-3.1 {
  CREATE VIRTUAL TABLE a USING rtree_i32(b, c, d);
  CREATE TABLE e(b, d);
  INSERT INTO e VALUES( '', '');
  ALTER TABLE e RENAME b TO f;
  SELECT *FROM a, e WHERE(c) BETWEEN 0 AND(json_patch(f, 0));
} {1 {malformed JSON}}

# kill mutants ['7254', '7256', '7260', '7286', '7288', '7292']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test whereexpr-dredd-4.1 {
  CREATE TABLE a(b);
  ALTER TABLE a ADD c;
  INSERT INTO a(c) VALUES(0);
  ALTER TABLE a RENAME TO d;
  CREATE INDEX e ON d(b);
  CREATE TABLE f(b);
  INSERT INTO f VALUES('0815');
  SELECT *FROM d, f WHERE c NOT NULL ORDER BY(0) GLOB(0);
} {0815 0}

# kill mutants ['7051']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test whereexpr-dredd-5.1 {
  CREATE TABLE a(b, d);
  CREATE VIEW e(c)
  AS SELECT 0;
  SELECT *FROM a RIGHT JOIN e ON((0)OR(0)) AND(0, 0, d, 0, c) = (0, '', b, 0, c);
} {{} {} 0}

# kill mutants ['5958', '6007']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_catchsql_test whereexpr-dredd-6.1 {
  CREATE VIRTUAL TABLE a USING fts5(0);
  CREATE TABLE b(c);
  CREATE TABLE d(e);
  CREATE TABLE f(g);
  SELECT *FROM b FULL JOIN a JOIN d ON(g)
  JOIN f;
} {1 {ON clause references tables to its right}}

# kill mutants ['5266', '5267', '5298', '5299']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test whereexpr-dredd-7.1 {
  CREATE TABLE a(b);
  CREATE TABLE c(b);
  INSERT INTO a VALUES(0);
  REPLACE INTO c VALUES(0);
  CREATE INDEX d ON c(json_patch(0, 0));
  ALTER TABLE a ADD e;
  INSERT INTO a VALUES(0, 'f7c1def4');
  ALTER TABLE c RENAME TO f;
  INSERT INTO f VALUES(1);
  UPDATE a SET e ='';
  ALTER TABLE a RENAME e TO g;
  ANALYZE;
  SELECT *FROM f, a WHERE((0)OR(g)) = 0;
} {0 {} 0 {} 0 {} 0 {}}

# kill mutants ['7199', '7231', '7235', '7244', '7267', '7276']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test whereexpr-dredd-8.1 {
  CREATE TABLE t0(c0);
  ALTER TABLE t0 RENAME c0 TO c96;
  INSERT INTO t0 VALUES('');
  INSERT OR IGNORE INTO t0 VALUES(0);
  CREATE INDEX i52 ON t0(c96);
  CREATE TABLE t1(c0);
  INSERT OR IGNORE INTO t1 VALUES(x'');
  SELECT *FROM t0, t1 WHERE(c0)
  NOT NULL;
} {{} {} 0 {}}

# kill mutants ['8913']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test whereexpr-dredd-9.1 {
  CREATE VIRTUAL TABLE a USING rtree_i32(b, c, d);
  CREATE TABLE e('819337522');
  INSERT INTO a(d) VALUES(0);
  SELECT(SELECT 0 FROM a LEFT JOIN e ON NULL >= c);
} {0}

finish_test
