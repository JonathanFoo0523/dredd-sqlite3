set testdir [file dirname $argv0]
source $testdir/tester.tcl

# kill mutants ['149', '152', '181', '184']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test update-dredd-1.1 {
  CREATE TABLE a(b, c);
  REPLACE INTO a(b) VALUES('e818');
  ALTER TABLE a RENAME c TO d;
  CREATE INDEX e ON a(d)
  WHERE b;
  UPDATE a SET b = 0.12192030747872595;
  ALTER TABLE a RENAME TO f;
  UPDATE f SET d = 0;
} {}

# kill mutants ['1819', '1820']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_catchsql_test update-dredd-2.1 {
  CREATE TABLE a(b);
  UPDATE a SET(b, c) = ('', x'');
} {1 {no such column: c}}

# kill mutants ['173']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test update-dredd-3.1 {
  CREATE TABLE a(b);
  ALTER TABLE a RENAME b TO c;
  ALTER TABLE a RENAME TO d;
  CREATE INDEX e ON d(CAST((5)AS));
  UPDATE d SET c = '1893848352';
} {}

# kill mutants ['178']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test update-dredd-4.1 {
  CREATE TABLE a(b, c);
  REPLACE INTO a(b) VALUES('e818');
  ALTER TABLE a RENAME c TO d;
  CREATE INDEX e ON a(CASE WHEN 0 THEN 0 END) WHERE b;
  UPDATE a SET b = 0.12192030747872595;
  ALTER TABLE a RENAME TO f;
  UPDATE f SET d = 0;
} {}

# kill mutants ['179']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_catchsql_test update-dredd-5.1 {
  CREATE TABLE t1 (a  );
        ALTER TABLE t1 RENAME  a TO c15;
        ALTER TABLE t1 RENAME TO t0;
        CREATE UNIQUE INDEX i40 ON t0(CAST((c15) AS b) DESC);
        UPDATE t0 SET c15='-1893848352' WHERE ((json_array0));
} {1 {no such column: json_array0}}

# kill mutants ['175']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test update-dredd-6.1 {
          CREATE TABLE t1 (c0  );
              CREATE INDEX i46 ON t1(0 ASC)          ;
              ALTER TABLE t1 RENAME c0 TO c15;
              ALTER TABLE t1 RENAME TO t0;
              UPDATE t0 SET c15=0;
} {}

# kill mutants ['4645']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_catchsql_test update-dredd-7.1 {
  CREATE TABLE a(b TEXT, PRIMARY KEY(b)) WITHOUT ROWID;
  UPDATE a SET b = 'hቛ';
  CREATE INDEX IF NOT EXISTS i73 ON a((b NOTNULL));
  UPDATE a SET b == 0xfffffffff9658d1e;
  ALTER TABLE a RENAME b TO c97;
  INSERT INTO a(c97) VALUES('94399978'), ('e8cd');
  UPDATE OR REPLACE a SET c97 =
      NULL WHERE CASE((((c97)))AND(a.c97))
          WHEN CASE a.c97 WHEN a.c97 THEN a.c97 END THEN(0)
              ELSE((c97)BETWEEN((a.c97)) AND((c97))) END;
} {1 {NOT NULL constraint failed: a.c97}}

# kill mutants ['1837']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_catchsql_test update-dredd-8.1 {
  CREATE TABLE a(b);
  ALTER TABLE a RENAME TO c;
  UPDATE c SET d ='' WHERE e;
} {1 {no such column: d}}

# kill mutants ['4610']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_catchsql_test update-dredd-9.1 {
  CREATE TABLE b(a TEXT, PRIMARY KEY(a)) WITHOUT ROWID;
  ALTER TABLE b RENAME a TO c;
  INSERT INTO b VALUES(1.068457089E9);
  INSERT INTO b VALUES('');
  UPDATE b SET(c) = 0;
} {1 {UNIQUE constraint failed: b.c}}

finish_test
