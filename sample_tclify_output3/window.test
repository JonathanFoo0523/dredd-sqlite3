set testdir [file dirname $argv0]
source $testdir/tester.tcl

# kill mutants ['259', '260', '261', '262', '263']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_catchsql_test window-dredd-1.1 {
  SELECT NTH_VALUE('', 0) OVER(RANGE CURRENT ROW EXCLUDE NO OTHERS);
} {1 {second argument to nth_value must be a positive integer}}

# kill mutants ['10942']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_catchsql_test window-dredd-2.1 {
  CREATE TABLE t0 (c0 BLOB );
  CREATE TEMP TABLE t1 (c0 INTEGER , c1 CHECK (0) , c2 REAL );
  ALTER TABLE t0 RENAME c0 TO a;
  ALTER TABLE t1 ADD c43 b;
  ALTER TABLE t0 RENAME a TO c;
  ALTER TABLE t0 RENAME c TO e;
  ALTER TABLE t1 RENAME c0 TO c60;
  BEGIN;
  ALTER TABLE t1 RENAME TO t2;
  SELECT COUNT() OVER ( PARTITION BY CASE c2  WHEN c43 THEN c2 END BETWEEN c1=c43 AND t2.c43>t2.c60, 0 ROWS BETWEEN 0 FOLLOWING AND d FOLLOWING), AVG(0)FROM t2 RIGHT JOIN t0 ON 3   BETWEEN c43>c60 AND 0;
} {1 {frame ending offset must be a non-negative integer}}

# kill mutants ['2379', '2381', '2388', '2411', '2413']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test window-dredd-3.1 {
  SELECT TOTAL(0 IS FALSE) OVER();
} {1.0}

# kill mutants ['3609', '3641']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test window-dredd-4.1 {
  CREATE TABLE a(b);
  ALTER TABLE a ADD c;
  REPLACE INTO a VALUES('1f84', ''), (NULL, 0.31702424464621537), ('', NULL);
  SELECT DISTINCT DENSE_RANK() OVER(), LAST_VALUE(0) OVER(PARTITION BY 0) FROM a;
} {1 0}

# kill mutants ['7561', '7593']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test window-dredd-5.1 {
  SELECT PERCENT_RANK() OVER(), LAG(0, CAST(CASE WHEN 0 THEN 6 END AS), 0) OVER();
} {0.0 0}

# kill mutants ['11983', '12015']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_catchsql_test window-dredd-6.1 {
  SELECT LAST_VALUE(NULL)
      OVER(ORDER BY(0, CASE WHEN 8 THEN 6 END, 0) >
           (0, 0, CASE WHEN 3 THEN 'k|l)d' END)GROUPS(a) PRECEDING);
} {1 {frame starting offset must be a non-negative integer}}

# kill mutants ['10910']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_execsql_test window-dredd-7.1 {
  CREATE TABLE a(b);
          CREATE TABLE e(c);
          ALTER TABLE e ADD f;
          ALTER TABLE e RENAME c TO g;
          ALTER TABLE e RENAME TO d;
          SELECT COUNT()     OVER(PARTITION BY CASE WHEN f THEN 2 END BETWEEN 0 AND 0 > g),     AVG(0) FROM d JOIN a ON(f) BETWEEN f > g AND 0;
} {1 {}}

# kill mutants ['1322']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_catchsql_test window-dredd-8.1 {
  SELECT ROW_NUMBER() OVER(RANGE BETWEEN a PRECEDING AND b FOLLOWING);
} {1 {RANGE with offset PRECEDING/FOLLOWING requires one ORDER BY expression}}

# kill mutants ['1325']
reset_db
sqlite3_db_config db DEFENSIVE 1
do_catchsql_test window-dredd-9.1 {
  SELECT LAG(a) OVER(RANGE b PRECEDING);
} {1 {RANGE with offset PRECEDING/FOLLOWING requires one ORDER BY expression}}

finish_test
